general {
    lock_cmd = pidof hyprlock || hyprlock       # avoid starting multiple hyprlock instances.
    before_sleep_cmd = loginctl lock-session    # lock before suspend.
    after_sleep_cmd = hyprctl dispatch dpms on  # to avoid having to press a key twice to turn on the display.
}

# Gentle brightness dim (no DPMS; safe for AMD/Intel)
listener {
    timeout = 300                                 # 5min
    on-timeout = bash -lc 'command -v brightnessctl >/dev/null 2>&1 && brightnessctl -q -s set 20%'
    on-resume  = bash -lc 'command -v brightnessctl >/dev/null 2>&1 && brightnessctl -q -r'
}

listener {
    timeout = 600                      # 10min
    on-timeout = loginctl lock-session # lock screen when timeout has passed
}

# DPMS listener - avoid AMD and Intel due to wake/positioning issues
# AMD/Intel GPUs have issues with hyprctl dispatch dpms off/on causing off-screen windows after lock
listener {
    timeout = 900                                 # 15min
    on-timeout = bash -c 'if ! lspci | grep -qiE "intel.*vga|amd/ati.*vga" >/dev/null 2>&1; then hyprctl dispatch dpms off; fi'
    on-resume = bash -c 'if ! lspci | grep -qiE "intel.*vga|amd/ati.*vga" >/dev/null 2>&1; then hyprctl dispatch dpms on; fi'
}
