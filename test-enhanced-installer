#!/bin/bash

# Test script for OhmArchy Enhanced Installer Progress Bars
# This safely demonstrates the progress bars without running the actual installer

set -euo pipefail

# Load the progress bar library
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
if [[ -f "$SCRIPT_DIR/install/lib/progress-bars.sh" ]]; then
    source "$SCRIPT_DIR/install/lib/progress-bars.sh"
else
    echo "‚ùå Progress bar library not found!"
    exit 1
fi

# Simulate the enhanced installer experience
echo "üß™ Testing OhmArchy Enhanced Installer Progress Bars"
echo "===================================================="
echo ""
echo "This demo shows how the enhanced installer would look with progress bars."
echo "No actual installation is performed - this is 100% safe!"
echo ""

read -p "Press Enter to start the demo..."
clear

# Initialize progress system (simulate real installer)
init_progress 8

# Simulate installation modules with realistic tasks
declare -a test_modules=(
    "Base system setup:BLUE"
    "User identity configuration:BLUE"
    "Desktop environment:PURPLE"
    "Configuration files:CYAN"
    "Shell setup:GREEN"
    "System services:ORANGE"
    "Development tools:GREEN"
    "Applications:GREEN"
)

echo ""
echo "Simulating OhmArchy installation with progress bars..."
echo ""

for module_info in "${test_modules[@]}"; do
    IFS=':' read -r module color <<< "$module_info"

    # Start the task
    start_task "$module" "$color"

    # Simulate installation progress
    for percent in {0..100..8}; do
        update_progress $percent "$color"
        sleep 0.1
    done

    # Complete the task
    complete_task "GREEN"
    sleep 0.5
done

# Show completion
echo ""
echo -e "${PROGRESS_COLORS[GREEN]}${PROGRESS_COLORS[BOLD]}‚úÖ Demo Complete!${PROGRESS_COLORS[RESET]}"
echo ""
echo "This is how the enhanced installer would look with:"
echo "  ‚úÖ Perfect alignment"
echo "  ‚úÖ Themed colors"
echo "  ‚úÖ Progress tracking"
echo "  ‚úÖ Clean, professional appearance"
echo ""
echo "The enhanced installer (install-enhanced.sh) is ready for use!"
echo "It preserves ALL existing functionality and error handling."
echo ""
echo "Usage:"
echo "  ./install.sh         # Enhanced installer with progress bars (DEFAULT)"
echo "  ./install-plain.sh   # Original installer without progress bars"
