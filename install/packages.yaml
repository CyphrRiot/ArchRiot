# ArchRiot YAML Package Configuration

core:
    sudo:
        packages: []
        configs: []
        commands:
            - "sudo -n true || (echo 'Setting up passwordless sudo...' && sudo usermod -aG wheel $USER)"
            - "sudo grep -q '^%wheel.*NOPASSWD.*ALL' /etc/sudoers || echo '%wheel ALL=(ALL) NOPASSWD: ALL' | sudo tee -a /etc/sudoers"
            - "sudo -k && sudo -n true"
        depends: []
        start: "Setting up passwordless sudo"
        end: "Sudo configured"
        type: "System"

    base:
        packages:
            - base-devel
            - git
            - rsync
            - bc
            - go-yq
            - python
            - python-psutil
        configs:
            - pattern: fish/*
            - pattern: environment.d/*
            - pattern: systemd/*
        commands:
            - "python3 -c 'import psutil'"
            - "systemctl --user daemon-reload"
            - "systemctl --user enable version-check.timer 2>/dev/null || true"
            - "systemctl --user start version-check.timer 2>/dev/null || true"
        depends: [core.sudo]
        start: "Installing base development tools"
        end: "Base tools installed"
        type: "Package"

    identity:
        packages: []
        configs: []
        commands:
            - "git config --global alias.co checkout"
            - "git config --global alias.br branch"
            - "git config --global alias.ci commit"
            - "git config --global alias.st status"
            - "git config --global pull.rebase true"
            - "git config --global init.defaultBranch master"
        depends: [core.base]
        start: "Configuring Git identity"
        end: "Git identity configured"
        type: "Git"

    shell:
        packages:
            - fish
            - starship
            - inetutils
            - neovim
            - kitty
            - fd
            - fzf
            - ripgrep
            - zoxide
            - bat
            - lsd
            - wl-clipboard
            - man
            - less
            - whois
            - tldr
            - plocate
        configs:
            - pattern: fish/*
            - pattern: default/tmux.conf
              target: ~/.config/tmux/tmux.conf
        commands:
            - "sudo chsh -s /usr/bin/fish $USER"
        depends: [core.base]
        start: "Installing shell and terminal tools"
        end: "Shell environment configured"
        type: "Package"

desktop:
    hyprland:
        packages:
            - hyprland
            - waybar
            - fuzzel
            - mako
            - hyprlock
            - hypridle
            - swaybg
        configs:
            - pattern: hypr/*
            - pattern: waybar/*
            - pattern: fuzzel/*
            - pattern: mako/*
            - pattern: gtk-3.0/*
              preserve_if_exists: [bookmarks]
            - pattern: gtk-4.0/*
            - pattern: Thunar/*
            - pattern: bin/upgrade-system
              target: ~/.local/bin/
            - pattern: applications/*.desktop
              target: ~/.local/share/applications/
            - pattern: applications/hidden/*
              target: ~/.local/share/applications/

            - pattern: images/*
              target: ~/.local/share/archriot/images/
        commands:
            - "chmod +x ~/.local/bin/*"
            - "chmod +x ~/.local/share/archriot/config/bin/* ~/.local/share/archriot/config/bin/scripts/*"
            - "update-desktop-database ~/.local/share/applications/"
            - 'for dm in sddm gdm lightdm lxdm; do if pacman -Qi "$dm" &>/dev/null; then sudo systemctl stop "$dm" 2>/dev/null || true; sudo systemctl disable "$dm" 2>/dev/null || true; sudo pacman -Rns --noconfirm "$dm" 2>/dev/null || true; fi; done'
            - "sudo mkdir -p /etc/systemd/system/getty@tty1.service.d"
            - "echo -e '[Service]\\nExecStart=\\nExecStart=-/usr/bin/agetty --autologin $USER --noclear %I \\$TERM' | sudo tee /etc/systemd/system/getty@tty1.service.d/override.conf >/dev/null"
        depends: [core.base]
        start: "Installing Hyprland desktop"
        end: "Hyprland desktop installed"
        type: "Package"

    apps:
        packages:
            - ghostty
            - ghostty-shell-integration
            - thunar
            - brave-bin
            - signal-desktop
            - brightnessctl
            - xdg-user-dirs
            - wl-clip-persist
            - hyprsunset
            - tumbler
            - ffmpegthumbnailer
            - libwebp
            - libheif
            - libavif
            - raw-thumbnailer
            - gnome-calculator
            - nwg-drawer
            - imv
            - mullvad-vpn-bin
        configs:
            - pattern: ghostty/*
            - pattern: xdg-desktop-portal/*
        commands:
            - "sudo mv /usr/share/thumbnailers/papers.thumbnailer /usr/share/thumbnailers/papers.thumbnailer.disabled 2>/dev/null || true"
            - "sudo mv /usr/share/thumbnailers/evince.thumbnailer /usr/share/thumbnailers/evince.thumbnailer.disabled 2>/dev/null || true"
            - "xdg-user-dirs-update"
        depends: [desktop.hyprland]
        start: "Installing desktop applications"
        end: "Desktop applications installed"
        type: "Package"

development:
    tools:
        packages:
            - zed
            - tree
        configs:
            - pattern: zed/*
              preserve_if_exists: [settings.json]
            - pattern: btop/*
        depends: [core.base]
        start: "Installing development tools"
        end: "Development tools installed"
        type: "Package"

    helpers:
        packages:
            - clang
            - cmake
            - ninja
            - rust
            - python-pip
            - go
            - github-cli
            - jq
            - zip
            - tmux
        configs: []
        commands:
            - "mkdir -p ~/.local/bin"
            - "curl -L -o ~/.local/bin/migrate https://raw.githubusercontent.com/CyphrRiot/Migrate/main/bin/migrate"
            - "chmod +x ~/.local/bin/migrate"
        depends: [core.base]
        start: "Installing development helpers"
        end: "Development helpers installed"
        type: "Package"

    editors:
        packages:
            - tree-sitter-cli
            - lua-language-server
            - pyright
            - typescript-language-server
            - bash-language-server
            - gopls
        configs: []
        commands:
            - "sudo ln -sf /usr/bin/nvim /usr/bin/vi"
        depends: [core.base]
        start: "Installing editor and LSP servers"
        end: "Editor environment configured"
        type: "Package"

system:
    fonts:
        packages:
            - ttf-font-awesome
            - noto-fonts
            - ttf-hack-nerd
            - ttf-cascadia-mono-nerd
            - ttf-ia-writer
        configs: []
        commands:
            - "fc-cache -f"
        depends: [core.base]
        start: "Installing system fonts"
        end: "Fonts installed and cached"
        type: "System"

    bluetooth:
        packages:
            - blueberry
        configs: []
        commands:
            - "sudo systemctl enable --now bluetooth.service"
        depends: [core.base]
        start: "Setting up Bluetooth"
        end: "Bluetooth configured"
        type: "System"

    printer:
        packages:
            - cups
            - cups-pdf
            - cups-filters
            - system-config-printer
        configs: []
        commands:
            - "sudo systemctl enable --now cups.service"
        depends: [core.base]
        start: "Installing printing system"
        end: "Printing system configured"
        type: "System"

    power:
        packages:
            - power-profiles-daemon
            - powertop
        configs: []
        commands:
            - "sudo systemctl enable --now power-profiles-daemon.service"
        depends: [core.base]
        start: "Configuring power management"
        end: "Power management configured"
        type: "System"

    filesystems:
        packages:
            - gvfs
            - udisks2
            - gvfs-smb
            - gvfs-mtp
            - ntfs-3g
            - dosfstools
            - exfatprogs
        configs: []
        commands:
            - "sudo systemctl enable --now udisks2.service"
        depends: [core.base]
        start: "Installing filesystem support"
        end: "Filesystem support configured"
        type: "System"

    networking:
        packages:
            - iwd
        configs: []
        commands:
            - "sudo systemctl enable --now iwd.service"
        depends: [core.base]
        start: "Configuring wireless networking"
        end: "Wireless networking configured"
        type: "System"

    audio:
        packages:
            - pipewire
            - pipewire-alsa
            - pipewire-pulse
            - pipewire-audio
            - pipewire-jack
            - gst-plugin-pipewire
            - libpipewire
            - wireplumber
            - pavucontrol
            - pamixer
            - playerctl
        configs: []
        commands:
            - "pacman -Qs ^pulseaudio$ && sudo pacman -Rdd --noconfirm pulseaudio || true"
            - "pacman -Qs ^jack2$ && sudo pacman -Rdd --noconfirm jack2 || true"
            - "systemctl --user enable --now pipewire.service"
            - "systemctl --user enable --now pipewire-pulse.service"
            - "systemctl --user enable --now wireplumber.service"
        depends: [core.base]
        start: "Installing PipeWire audio system"
        end: "Audio system configured"
        type: "System"

    memory:
        packages: []
        configs: []
        commands:
            - "sudo cp ~/.local/share/archriot/config/system/99-memory-optimization.conf /etc/sysctl.d/99-memory-optimization.conf"
            - "sudo sysctl -p /etc/sysctl.d/99-memory-optimization.conf"
        depends: [core.base]
        start: "Optimizing memory settings"
        end: "Memory optimization applied"
        type: "System"

    mimetypes:
        packages: []
        configs: []
        commands:
            - "update-desktop-database ~/.local/share/applications"
            - "xdg-mime default imv.desktop image/png"
            - "xdg-mime default imv.desktop image/jpeg"
            - "xdg-mime default imv.desktop image/gif"
            - "xdg-mime default imv.desktop image/webp"
            - "xdg-mime default imv.desktop image/bmp"
            - "xdg-mime default imv.desktop image/tiff"
            - "xdg-mime default org.gnome.Papers.desktop application/pdf"
            - "xdg-settings set default-web-browser brave-browser.desktop"
            - "xdg-mime default brave-browser.desktop x-scheme-handler/http"
            - "xdg-mime default brave-browser.desktop x-scheme-handler/https"
            - "xdg-mime default org.gnome.TextEditor.desktop text/plain"
            - "xdg-mime default org.gnome.TextEditor.desktop text/markdown"
            - "xdg-mime default org.gnome.TextEditor.desktop text/x-markdown"
            - "xdg-mime default org.gnome.TextEditor.desktop application/x-markdown"
            - "xdg-mime default mpv.desktop video/mp4"
            - "xdg-mime default mpv.desktop video/x-msvideo"
            - "xdg-mime default mpv.desktop video/x-matroska"
            - "xdg-mime default mpv.desktop video/x-flv"
            - "xdg-mime default mpv.desktop video/x-ms-wmv"
            - "xdg-mime default mpv.desktop video/mpeg"
            - "xdg-mime default mpv.desktop video/ogg"
            - "xdg-mime default mpv.desktop video/webm"
            - "xdg-mime default mpv.desktop video/quicktime"
            - "xdg-mime default mpv.desktop video/3gpp"
            - "xdg-mime default mpv.desktop video/3gpp2"
            - "xdg-mime default mpv.desktop video/x-ms-asf"
            - "xdg-mime default mpv.desktop video/x-ogm+ogg"
            - "xdg-mime default mpv.desktop video/x-theora+ogg"
            - "xdg-mime default mpv.desktop application/ogg"
        depends: [core.base]
        start: "Configuring file associations"
        end: "File associations configured"
        type: "System"

    privacy:
        packages: []
        configs: []
        commands:
            - "gsettings set org.gnome.desktop.privacy remember-recent-files false || true"
            - "rm -f ~/.local/share/recently-used.xbel"
        depends: [core.base]
        start: "Configuring desktop privacy"
        end: "Privacy settings applied"
        type: "System"

    hardware:
        packages:
            - usbutils
            - pciutils
        configs: []
        commands:
            - "sudo sed -i '/^#\\[multilib\\]/,/^#Include/ s/^#//' /etc/pacman.conf"
            - "if lspci | grep -qi nvidia; then yay -S --noconfirm --needed nvidia-dkms nvidia-utils lib32-nvidia-utils; fi"
            - "if lspci | grep -qi -E 'amd|radeon'; then yay -S --noconfirm --needed mesa lib32-mesa vulkan-radeon lib32-vulkan-radeon; fi"
            - "if lspci | grep -i intel | grep -qi -E 'vga|3d|display|graphics'; then yay -S --noconfirm --needed mesa lib32-mesa vulkan-intel lib32-vulkan-intel intel-media-driver intel-gmmlib libva-intel-driver; fi"
            - "if command -v lsusb >/dev/null 2>&1 && lsusb | grep -i apple | grep -qi keyboard; then echo 'options hid_apple fnmode=2' | sudo tee /etc/modprobe.d/hid_apple.conf >/dev/null; fi"
        depends: [core.base]
        start: "Setting up hardware drivers"
        end: "Hardware drivers configured"
        type: "System"

media:
    players:
        packages:
            - mpv
            - lollypop
            - ffmpeg
            - yt-dlp
            - python-opencv
            - spotdl
        configs: []
        commands:
            - "yay -S --noconfirm --needed --mflags --nocheck spotdl"
        depends: [desktop.hyprland]
        start: "Installing media players"
        end: "Media players installed"
        type: "Package"
