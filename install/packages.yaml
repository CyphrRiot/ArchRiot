# ArchRiot YAML Package Configuration

core:
    sudo:
        packages: []
        configs: []
        commands:
            - "sudo -n true || (echo 'Setting up passwordless sudo...' && sudo usermod -aG wheel $USER)"
            - "sudo grep -q '^%wheel.*NOPASSWD.*ALL' /etc/sudoers || echo '%wheel ALL=(ALL) NOPASSWD: ALL' | sudo tee -a /etc/sudoers"
            - "sudo -k && sudo -n true"
        depends: []
        start: "Setting up passwordless sudo"
        end: "Sudo configured"
        type: "System"

    base:
        packages:
            - base-devel
            - git
            - rsync
            - bc
            - go-yq
        configs:
            - pattern: fish/*
              preserve_if_exists: []
            - pattern: environment.d/*
              preserve_if_exists: []
        depends: [core.sudo]
        start: "Installing base development tools"
        end: "Base tools installed"
        type: "Package"

    identity:
        packages: []
        configs: []
        depends: [core.base]
        start: "Configuring Git identity"
        end: "Git identity configured"
        type: "Git"

    shell:
        packages:
            - fish
            - starship
            - inetutils
            - neovim
            - kitty
            - fd
            - fzf
            - ripgrep
            - zoxide
            - bat
            - lsd
            - wl-clipboard
            - man
            - less
            - whois
            - tldr
            - plocate
        configs:
            - pattern: fish/*
              preserve_if_exists: []
        commands:
            - "sudo chsh -s /usr/bin/fish $USER"
        depends: [core.base]
        start: "Installing shell and terminal tools"
        end: "Shell environment configured"
        type: "Package"

desktop:
    hyprland:
        packages:
            - hyprland
            - waybar
            - fuzzel
            - mako
            - hyprlock
            - hypridle
            - swaybg
        configs:
            - pattern: hypr/*
              preserve_if_exists: []
            - pattern: waybar/*
              preserve_if_exists: []
            - pattern: fuzzel/*
              preserve_if_exists: []
            - pattern: mako/*
              preserve_if_exists: []
        depends: [core.base]
        start: "Installing Hyprland desktop"
        end: "Hyprland desktop installed"
        type: "Package"

    apps:
        packages:
            - ghostty
            - thunar
            - brave-bin
            - signal-desktop
        configs:
            - pattern: ghostty/*
              preserve_if_exists: []
        depends: [desktop.hyprland]
        start: "Installing desktop applications"
        end: "Desktop applications installed"
        type: "Package"

development:
    tools:
        packages:
            - zed
            - tree
        configs:
            - pattern: zed/*
              preserve_if_exists: [settings.json]
            - pattern: btop/*
              preserve_if_exists: []
        depends: [core.base]
        start: "Installing development tools"
        end: "Development tools installed"
        type: "Package"

    helpers:
        packages:
            - clang
            - cmake
            - ninja
            - rust
            - python-pip
            - go
            - github-cli
            - jq
            - zip
            - tmux
        configs: []
        commands:
            - "mkdir -p ~/.local/bin"
            - "curl -L -o ~/.local/bin/migrate https://raw.githubusercontent.com/CyphrRiot/Migrate/main/bin/migrate"
            - "chmod +x ~/.local/bin/migrate"
        depends: [core.base]
        start: "Installing development helpers"
        end: "Development helpers installed"
        type: "Package"

    editors:
        packages:
            - tree-sitter-cli
            - lua-language-server
            - pyright
            - typescript-language-server
            - bash-language-server
            - gopls
        configs: []
        commands:
            - "sudo ln -sf /usr/bin/nvim /usr/bin/vi"
        depends: [core.base]
        start: "Installing editor and LSP servers"
        end: "Editor environment configured"
        type: "Package"

system:
    fonts:
        packages:
            - ttf-font-awesome
            - noto-fonts
            - ttf-hack-nerd
            - ttf-cascadia-mono-nerd
            - ttf-ia-writer
        configs: []
        commands:
            - "fc-cache -f"
        depends: [core.base]
        start: "Installing system fonts"
        end: "Fonts installed and cached"
        type: "System"

    bluetooth:
        packages:
            - blueberry
        configs: []
        commands:
            - "sudo systemctl enable --now bluetooth.service"
        depends: [core.base]
        start: "Setting up Bluetooth"
        end: "Bluetooth configured"
        type: "System"

    printer:
        packages:
            - cups
            - cups-pdf
            - cups-filters
            - system-config-printer
        configs: []
        commands:
            - "sudo systemctl enable --now cups.service"
        depends: [core.base]
        start: "Installing printing system"
        end: "Printing system configured"
        type: "System"

    power:
        packages:
            - power-profiles-daemon
            - powertop
        configs: []
        commands:
            - "sudo systemctl enable --now power-profiles-daemon.service"
        depends: [core.base]
        start: "Configuring power management"
        end: "Power management configured"
        type: "System"

    filesystems:
        packages:
            - gvfs
            - udisks2
            - gvfs-smb
            - gvfs-mtp
            - ntfs-3g
            - dosfstools
            - exfatprogs
        configs: []
        commands:
            - "sudo systemctl enable --now udisks2.service"
        depends: [core.base]
        start: "Installing filesystem support"
        end: "Filesystem support configured"
        type: "System"

    networking:
        packages:
            - iwd
        configs: []
        commands:
            - "sudo systemctl enable --now iwd.service"
        depends: [core.base]
        start: "Configuring wireless networking"
        end: "Wireless networking configured"
        type: "System"

    audio:
        packages:
            - pipewire
            - pipewire-alsa
            - pipewire-pulse
            - pipewire-audio
            - pipewire-jack
            - gst-plugin-pipewire
            - libpipewire
            - wireplumber
            - pavucontrol
            - pamixer
            - playerctl
        configs: []
        commands:
            - "pacman -Qs ^pulseaudio$ && sudo pacman -Rdd --noconfirm pulseaudio || true"
            - "pacman -Qs ^jack2$ && sudo pacman -Rdd --noconfirm jack2 || true"
            - "systemctl --user enable --now pipewire.service"
            - "systemctl --user enable --now pipewire-pulse.service"
            - "systemctl --user enable --now wireplumber.service"
        depends: [core.base]
        start: "Installing PipeWire audio system"
        end: "Audio system configured"
        type: "System"

    memory:
        packages: []
        configs: []
        commands:
            - "sudo cp ~/.local/share/archriot/config/system/99-memory-optimization.conf /etc/sysctl.d/99-memory-optimization.conf"
            - "sudo sysctl -p /etc/sysctl.d/99-memory-optimization.conf"
        depends: [core.base]
        start: "Optimizing memory settings"
        end: "Memory optimization applied"
        type: "System"

    mimetypes:
        packages: []
        configs: []
        commands:
            - "update-desktop-database ~/.local/share/applications"
            - "xdg-mime default imv.desktop image/png"
            - "xdg-mime default imv.desktop image/jpeg"
            - "xdg-mime default imv.desktop image/gif"
            - "xdg-mime default imv.desktop image/webp"
            - "xdg-mime default imv.desktop image/bmp"
            - "xdg-mime default imv.desktop image/tiff"
            - "xdg-mime default org.gnome.Papers.desktop application/pdf"
            - "xdg-settings set default-web-browser brave-browser.desktop"
            - "xdg-mime default brave-browser.desktop x-scheme-handler/http"
            - "xdg-mime default brave-browser.desktop x-scheme-handler/https"
            - "xdg-mime default org.gnome.TextEditor.desktop text/plain"
            - "xdg-mime default org.gnome.TextEditor.desktop text/markdown"
            - "xdg-mime default org.gnome.TextEditor.desktop text/x-markdown"
            - "xdg-mime default org.gnome.TextEditor.desktop application/x-markdown"
            - "xdg-mime default mpv.desktop video/mp4"
            - "xdg-mime default mpv.desktop video/x-msvideo"
            - "xdg-mime default mpv.desktop video/x-matroska"
            - "xdg-mime default mpv.desktop video/x-flv"
            - "xdg-mime default mpv.desktop video/x-ms-wmv"
            - "xdg-mime default mpv.desktop video/mpeg"
            - "xdg-mime default mpv.desktop video/ogg"
            - "xdg-mime default mpv.desktop video/webm"
            - "xdg-mime default mpv.desktop video/quicktime"
            - "xdg-mime default mpv.desktop video/3gpp"
            - "xdg-mime default mpv.desktop video/3gpp2"
            - "xdg-mime default mpv.desktop video/x-ms-asf"
            - "xdg-mime default mpv.desktop video/x-ogm+ogg"
            - "xdg-mime default mpv.desktop video/x-theora+ogg"
            - "xdg-mime default mpv.desktop application/ogg"
        depends: [core.base]
        start: "Configuring file associations"
        end: "File associations configured"
        type: "System"

    privacy:
        packages: []
        configs: []
        commands:
            - "gsettings set org.gnome.desktop.privacy remember-recent-files false || true"
            - "rm -f ~/.local/share/recently-used.xbel"
            - "mkdir -p ~/.config/gtk-3.0"
            - "sed -i '/gtk-recent-files-enabled/d' ~/.config/gtk-3.0/settings.ini 2>/dev/null || true"
            - "sed -i '/gtk-recent-files-max-age/d' ~/.config/gtk-3.0/settings.ini 2>/dev/null || true"
            - "sed -i '/gtk-recent-files-limit/d' ~/.config/gtk-3.0/settings.ini 2>/dev/null || true"
            - "grep -q '^\\[Settings\\]' ~/.config/gtk-3.0/settings.ini 2>/dev/null || echo '[Settings]' >> ~/.config/gtk-3.0/settings.ini"
            - "sed -i '/^\\[Settings\\]/a gtk-recent-files-enabled=0\\ngtk-recent-files-max-age=0\\ngtk-recent-files-limit=0' ~/.config/gtk-3.0/settings.ini"
            - "mkdir -p ~/.config/gtk-4.0"
            - "sed -i '/gtk-recent-files-enabled/d' ~/.config/gtk-4.0/settings.ini 2>/dev/null || true"
            - "sed -i '/gtk-recent-files-max-age/d' ~/.config/gtk-4.0/settings.ini 2>/dev/null || true"
            - "sed -i '/gtk-recent-files-limit/d' ~/.config/gtk-4.0/settings.ini 2>/dev/null || true"
            - "grep -q '^\\[Settings\\]' ~/.config/gtk-4.0/settings.ini 2>/dev/null || echo '[Settings]' >> ~/.config/gtk-4.0/settings.ini"
            - "sed -i '/^\\[Settings\\]/a gtk-recent-files-enabled=0\\ngtk-recent-files-max-age=0\\ngtk-recent-files-limit=0' ~/.config/gtk-4.0/settings.ini"
            - "mkdir -p ~/.config/Thunar"
            - "sed -i '/LastShowRecent=/d' ~/.config/Thunar/thunarrc 2>/dev/null || true"
            - "echo 'LastShowRecent=FALSE' >> ~/.config/Thunar/thunarrc"
            - "mkdir -p ~/.local/bin"
            - "echo '#!/bin/bash' > ~/.local/bin/clear-recents"
            - "echo 'rm -f ~/.local/share/recently-used.xbel' >> ~/.local/bin/clear-recents"
            - 'echo ''find ~/.local/share/gtk-* -name "*recent*" -type f -delete 2>/dev/null || true'' >> ~/.local/bin/clear-recents'
            - 'echo ''find ~/.cache/thumbnails -name "*.xbel" -type f -delete 2>/dev/null || true'' >> ~/.local/bin/clear-recents'
            - "chmod +x ~/.local/bin/clear-recents"
        depends: [core.base]
        start: "Configuring desktop privacy"
        end: "Privacy settings applied"
        type: "System"

media:
    players:
        packages:
            - mpv
            - lollypop
            - ffmpeg
            - yt-dlp
            - python-opencv
            - spotdl
        configs: []
        commands:
            - "yay -S --noconfirm --needed --mflags --nocheck spotdl"
        depends: [desktop.hyprland]
        start: "Installing media players"
        end: "Media players installed"
        type: "Package"
